<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>书籍展示</title>
</head>
<body>
    <div id="filters">
        <select id="ratingFilter" onchange="filterBooks()">
            <option value="">所有评分</option>
            <option value="7">6-7 星</option>
            <option value="6">5-6 星</option>
            <option value="5">4-5 星</option>
            <option value="4">3-4 星</option>
            <option value="3">2-3 星</option>
            <option value="2">1-2 星</option>
        </select>
        <label>
            <input type="checkbox" id="votesFilter" onchange="filterBooks()">
            仅显示评分人数大于 5 的书籍
        </label>
    </div>

    <table border="1">
        <thead>
            <tr>
                <th>书名</th>
                <th>作者</th>
                <th>类别</th>
                <th>评分</th>
                <th>字数</th>
                <th>链接</th>
            </tr>
        </thead>
        <tbody id="bookTable">
            <!-- 动态添加行 -->
        </tbody>
    </table>

    <script>
        const filePaths = ['1.txt', '2.txt', '3.txt', '4.txt', '5.txt', '6.txt'];
        let allBooks = [];

        // 加载所有文件并解析内容
        async function loadBooks() {
            const fetchPromises = filePaths.map(path =>
                fetch(path).then(response => response.text())
            );
            const contents = await Promise.all(fetchPromises);

            // 合并解析后的书籍数据
            allBooks = contents.flatMap(parseBooks);
            displayBooks(allBooks);
        }

        // 解析 TXT 文件内容
        function parseBooks(content) {
            return content.split('\n').filter(line => line.trim()).map(line => {
                const [id, order, category, rating, votes, name, words, author, link, dbId] = line.split(',');
                return { name, author, category, rating: parseFloat(rating), votes: parseInt(votes), words, link };
            });
        }

        // 根据评分和评分人数过滤书籍
        function filterBooks() {
            const ratingFilter = parseFloat(document.getElementById('ratingFilter').value) || 0;
            const filterVotes = document.getElementById('votesFilter').checked;

            const filteredBooks = allBooks.filter(book => {
                const isRatingMatch = ratingFilter === 0 || (book.rating >= ratingFilter && book.rating < ratingFilter + 1);
                const isVotesMatch = !filterVotes || book.votes >= 5;
                return isRatingMatch && isVotesMatch;
            });

            displayBooks(filteredBooks);
        }

        // 显示书籍列表
        function displayBooks(books) {
            const tableBody = document.getElementById('bookTable');
            tableBody.innerHTML = ''; // 清空表格内容

            books.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${book.name}</td>
                    <td>${book.author}</td>
                    <td>${book.category}</td>
                    <td>${book.rating}</td>
                    <td>${book.words}</td>
                    <td><a href="${book.link}" target="_blank">链接</a></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 初始化加载书籍
        loadBooks();
    </script>
</body>
</html>
